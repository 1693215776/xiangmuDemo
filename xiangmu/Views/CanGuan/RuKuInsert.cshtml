
@{
    ViewBag.Title = "RuKuInsert";
    Layout = "~/Views/mubanye/ym.cshtml";
}
@{ 
    
}

<head>      
        <link href="~/yangshi/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet" />
        <script src="~/Scripts/jquery-3.3.1.min.js"></script>
        <link href="~/images/iconfont/iconfont.css" rel="stylesheet" />
    </head>
<style>
    .black_overlay {
        display: none;
        position: absolute;
        top: 0%;
        left: 0%;
        width: 100%;
        height: 100%;
        background-color: black;
        z-index: 1001;
        opacity: .80;
        filter: alpha(opacity=88);
    }

    .white_content {
        display: none;
        position: absolute;
        top: 25%;
        left: 40%;
        width: 20%;
        height: 65%;
        padding: 20px;   
        background-color: white;
        z-index: 1002;
        overflow: auto;
    }
     .black_overlays {
       display: none;
        position: absolute;
        top: 0%;
        left: 0%;
        width: 100%;
        height: 100%;
        background-color: black;
        z-index: 1001;
        opacity: .80;
        filter: alpha(opacity=88);
    }

    .white_contents {
      display: none;
        position: absolute;
        top: 25%;
        left: 25%;
        width: 55%;
        height: 55%;
        padding: 20px;
        background-color: white;
        z-index: 1002;
        overflow: auto;
    }

   

     .white_contentss {
      display: none;
        position: absolute;
        top: 25%;
        left: 25%;
        width: 55%;
        height: 55%;
        padding: 20px;
        background-color: white;
        z-index: 1002;
        overflow: auto;
    }     

     .white_contentsss {
      display: none;
        position: absolute;
        top: 25%;
        left: 25%;
        width: 55%;
        height: 55%;
        padding: 20px;
        background-color: white;
        z-index: 1002;
        overflow: auto;
    }
</style>

<form> 
    <div class="row show-grid" style="width:1600px;margin-left:290px">
        <div class=" col-md-4">
            <label for="validationDefault01">入库单编号</label>

            <input type="text" class="form-control" id="validationDefault02" value="可不填,自动生成" readonly>
        </div>
        <div class="form-group col-md-4 ">
            <label for="inputState">入库单类型</label>         
                <select name="danhao" id="danhao" class="form-control">
                    @foreach (var item in ViewBag.rukudan)
                    {
                        <option value="@item.typeid" >@item.typename</option>
                    }
                </select>                       
        </div>
        <div class="col-md-4 ">
            <label for="validationDefault01">关联订单号</label>
            <input type="text" class="form-control" name="d1" id="validationDefault02" y>
        </div>
        <div class="col-md-4 ">
            <label for="validationDefault01">制单人</label>
            <input type="text" class="form-control" name="d2" id="validationDefault02" value="administrator">
        </div>

        <div class="col-md-4 ">
            <label for="validationDefault01">供应商编号</label>
            <input type="text" name="d3" class="form-control" id="g1"  href="javascript:void(0)" ondblclick="document.getElementById('dh').style.display = 'block'; document.getElementById('fade').style.display = 'block'; gyschaxun();" placeholder="输入关键字搜索或双击搜索" />
        </div>
        <div class="col-md-4 ">
            <label for="validationDefault01">供应商名称</label>
            <input type="text" name="d4" class="form-control" id="g2" y>
        </div>
        <div class="col-md-4 ">
            <label for="validationDefault01">供应商联系人</label>
            <input type="text" name="d5" class="form-control" id="g3" y>
        </div>
        <div class="col-md-4 ">
            <label for="validationDefault01">供应商联系方式</label>
            <input type="text" name="d6" class="form-control" id="g4" y>
        </div>
        <div class="col-md-4 ">
            <label for="validationDefault01">制单时间</label>
            <input type="date" class="form-control" id="sj" y>
        </div>
        <div class="col-md-12 ">
            <label for="validationDefault01">备注</label>
            <input type="text" name="d7" class="form-control" id="beizhu" y>
        </div>
    </div>
</form>
<div style="width:1570px; margin-left:305px; margin-top:20px;">
    <table class="table table-striped table-bordered table-hover"   id="tabInfo">
        <thead>
            <tr class="widget-title">                           
                <th class="hidden-480">产品名称</th>
                <th class="hidden-480">产品条码</th>
                <th class="hidden-480">规格</th>
                <th class="hidden-480">批次</th>
                <th class="hidden-480">单价</th>
                <th class="hidden-480">入库数</th>
                <th class="hidden-480">总价</th>
                <th class="hidden-480">库位</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
           
        </tbody>
    </table>
</div>
<div class="row">
    <div class="col-md-8 text-right">


        <button type="button" class="btn btn-primary" style="margin-top:30px;" href="javascript:void(0)"  onclick="document.getElementById('light').style.display='block';document.getElementById('fade').style.display='block'">新增产品</button>
        <button type="button" class="btn btn-primary" id="xzan" style="margin-top:30px;">添加</button>
        <button type="button" class="btn btn-secondary" href="@Url.Action("CarQuery")" style="margin-right:100px;margin-top:30px;">返回列表</button>
    </div>

    <div id="light" class="white_content">
        <div style="background-color:cyan;text-align:center">入库产品</div>
        <div class="tab-pane active" id="widget_tab1">
            <table class="dialogtab" style="margin-left:35px;  ">
                <tbody>
                    <tr>
                        <td>产品编码&nbsp;&nbsp;</td>
                        <td>
                            <input type="text" class="form-control" id="cpbm" name="mytd" href="javascript:void(0)" ondblclick="document.getElementById('cctv').style.display = 'block'; document.getElementById('fade').style.display = 'block'; bindData();" placeholder="双击选择" />
                        </td>
                    </tr>
                    <tr>
                        <td>产品名称</td>
                        <td>
                            <input type="text" class="form-control" name="cpmc" id="cpmc" readonly style="margin-top:10px;"><br />
                        </td>
                    </tr>
                    <tr>
                        <td>产品规格</td>
                        <td>
                            <input type="text" class="form-control" name="cpgg" id="" readonly><br />
                        </td>
                    </tr>
                    <tr>
                        <td>产品单价</td>
                        <td>
                            <input type="text" class="form-control" name="cpdj" id="cpdj" y><br />
                        </td>
                    </tr>
                    <tr>
                        <td>现有库存</td>
                        <td>
                            <input type="text" class="form-control" id="xykc" readonly><br />

                        </td>
                    </tr>
                    <tr>
                        <td>产品批次</td>
                        <td>
                            <input type="text" class="form-control" name="cppc" id="validationDefault02" y><br />
                        </td>
                    </tr>
                    <tr>
                        <td>入库库位</td>
                        <td>
                            <input type="text" class="form-control" name="rkkw" id="lzyqq" href="javascript:void(0)" ondblclick="document.getElementById('kuwei').style.display = 'block'; document.getElementById('fade').style.display = 'block'; kuweichaxun();" placeholder="双击选择" />
                        </td>
                    </tr>
                    <tr>
                        <td>入库数量</td>
                        <td>
                            <input type="text" class="form-control" name="rksl" id="validationDefault02" y>

                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <button type="button" id="xuanze" class="btn btn-primary" style="margin-top:20px;margin-left:130px;">确定</button>
        <button type="button" class="btn btn-secondary" style="margin-top:20px;" href="javascript:void(0)" onclick="document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'">关闭</button>
    </div>@*产品*@

    <div id="kuwei" class="white_contentss" >
        <div>
            <form class="form-inline">
                <div class="form-group mb-3">
                    <label>库位编号/名称</label>
                </div>
                <div class="form-group mx-sm-3 mb-2">
                    <input type="text" class="form-control" id="lb1">
                </div>
                <div class="form-group mx-sm-3 mb-2" style="height:15px;">
                    <div class="form-group mb-3" style="width:200px;">
                        <label for="inputState" style="width:60px;">库位类型</label>
                    </div>
                    <div style="position: absolute;top: 4%;left: 38%;">
                        <select id="leixing1" class="form-control">
                            @foreach (var item in ViewBag.kuweileixing)
                            {
                                <option value="@item.kuWeiTypeid" >@item.kuWeiTypename</option>
                            }
                        </select>
                    </div>

                </div>
                <button type="button" style="margin-left:20px;" id="btnSearch1" class="btn btn-primary mb-2">搜索</button>&nbsp;&nbsp;
            </form>
            <hr />
            <hr />
            <div style="width:1000px;height:50px;">
                <table class="table table-striped table-bordered table-hover" id="tabInfo">
                    <thead>
                        <tr class="widget-title">
                            <td style="width: 8px;"><input type="checkbox" class="group-checkable" onclick="check2(this.checked)" /></td>
                            <td class="hidden-480">库位编号</td>
                            <td class="hidden-480">库位名称</td>
                            <td class="hidden-480">库位类型</td>
                            <td class="hidden-480">是否禁用</td>
                            <td class="hidden-480" >是否默认</td>

                        </tr>
                    </thead>

                </table>
                <div style="">
                    <div style="margin-top:240px;margin-left:730px;">
                        <button type="button" class="btn btn-primary" id="tijiao1" style="margin-top:10px;margin-left:130px ;">确定</button>
                        <button type="button" class="btn btn-secondary" style="margin-top:10px;" href="javascript:void(0)" onclick="document.getElementById('kuwei').style.display='none';document.getElementById('kuweis').style.display='none'">关闭</button>
                    </div>
                </div>
            </div>
        </div>
    </div>@*库位*@


    <div id="dh" class="white_contentsss">
        <div>
            <form class="form-inline">
                <div class="form-group mb-3">
                    <label>供应商编号/名称</label>
                </div>
                <div class="form-group mx-sm-3 mb-2">
                    <input type="text" class="form-control" id="die">
                </div>
                <button type="button" id="sousuo" class="btn btn-primary mb-2">搜索</button>&nbsp;&nbsp;               
            </form>
            <hr />
            <hr />
            <div style="width:1000px;height:50px;">
                <table class="table table-striped table-bordered table-hover" id="tabInfo">
                    <thead>
                        <tr class="widget-title">
                            <th style="width: 8px;"><input type="checkbox" class="group-checkable" onclick="InStorageManager.SelectAll(this)" /></th>
                            <th class="hidden-480">供应商编号</th>
                            <th class="hidden-480">供应商名称</th>
                            <th class="hidden-480">联系方式</th>
                            <th class="hidden-480">联系人</th>
                            <th class="hidden-480">Email</th>
                            <th class="hidden-400">传真</th>
                            <th class="hidden-400">地址</th>
                        </tr>
                    </thead>                                                                
                </table>
                <div style="">
                    <div style="margin-top:-170px;margin-left:730px;">
                        <button type="button" id="qd" class="btn btn-primary" style="margin-top:10px;margin-left:130px;">确定</button>
                        <button type="button" class="btn btn-secondary" style="margin-top:10px;" href="javascript:void(0)" onclick="document.getElementById('dh').style.display='none';document.getElementById('fade').style.display='none'">关闭</button>
                    </div>
                </div>
            </div>
        </div>
    </div>@*供应商*@

    @*类别管理*@
    <div id="cctv" class="white_contents">
        <div>
            <form class="form-inline">
                <div class="form-group mb-3">
                    <label>类别编号/名称</label>
                </div>
                <div class="form-group mx-sm-3 mb-2">
                    <input type="text" class="form-control" id="lb">
                </div>
                <div class="form-group mx-sm-3 mb-2" style="height:15px;">
                    <div class="form-group mb-3" style="width:200px;">
                        <label for="inputState" style="width:30px;">类别</label>
                    </div>
                    <div style="position: absolute;top: 4%;left: 38%;">
                        <select id="leixing2" class="form-control">
                            @foreach (var item in ViewBag.leixing)
                            {
                                <option value="@item.productid" >@item.productname</option>
                            }
                        </select>
                    </div>

                </div>
                <button type="button" id="btnSearch" class="btn btn-primary mb-2">搜索</button>&nbsp;&nbsp;
            </form>
            <hr />
            <hr />
            <div style="width:1000px;height:50px;">
                <table class="table table-striped table-bordered table-hover" id="tabInfo">
                    <thead>
                        <tr class="widget-title">
                            <td style="width: 8px;"><input type="checkbox" class="group-checkable" onclick="check(this.checked)" /></td>
                            <td class="hidden-480">产品编号</td>
                            <td class="hidden-480">产品名称</td>
                            <td class="hidden-480">类别</td>
                            <td class="hidden-480">单价</td>
                            <td class="hidden-480">单位</td>
                            @*<th class="hidden-400">规格</th>
                                <th class="hidden-400">描述</th>
                                <th class="hidden-400">备注</th>*@
                        </tr>
                    </thead>

                </table>
                <div style="">
                    <div style="margin-top:240px;margin-left:730px;">
                        <button type="button" class="btn btn-primary" id="tijiao" style="margin-top:10px;margin-left:130px ;">确定</button>
                        <button type="button" class="btn btn-secondary" style="margin-top:10px;" href="javascript:void(0)" onclick="document.getElementById('cctv').style.display='none';document.getElementById('fades').style.display='none'">关闭</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    @*弹出框*@
    <div id="fade" class="black_overlays"></div>
    <div id="fades" class="black_overlays"></div>
    <div id="kuweis" class="black_overlays"></div>
  
</div>


<script type="text/javascript">
    //类别的
    $(function () {

       

       $("#btnSearch").click(function () {
           bindData(1);
       });
        //类别的的绑定数据到控件上
          $("#tijiao").click(function () {
              getCheckBoxValueThree(); 
             document.getElementById('cctv').style.display='none';document.getElementById('fades').style.display='none'
          });
        //库位的绑定数据到控件上
         $("#tijiao1").click(function () {
             getCheckBoxValueThree1();
            document.getElementById('kuwei').style.display='none';document.getElementById('kuweis').style.display='none'
             
         });
        //库位查询
        $("#btnSearch1").click(function () {
            kuweichaxun();
        });
        //将获取的值上传子页面
        $("#xuanze").click(function () {           
            chuancan();
            document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'
           
        });
        //供应商
         $("#sousuo").click(function () {           
            gyschaxun();
         });
        ///供应商确定绑定数据到text上
        $("#qd").click(function () {              
            getCheckBoxValueThree2();
            document.getElementById('dh').style.display='none';document.getElementById('fade').style.display='none'
        });
         $("#xzan").click(function () { 
             addAction()
            
        });

       

    });
   
    function chuancan() {
        var tt = ($("[name=mytd]").val());//产品条码       
      
        var tt2 = ($("[name=cpmc]").val());//产品名称  
        
        var tt3 = ($("[name=cpgg]").val());//产品规格 

        var tt4 = ($("[name=cppc]").val());//产品批次  
        
        var tt5 = ($("[name=cpdj]").val());//产品单价   

        var tt6 = ($("[name=rksl]").val());//入库数量 

        var tt7 = (parseInt(tt6) * parseFloat(tt5));//总价

        var tt8 = ($("[name=rkkw]").val());//入库库位
     
                    var str = "<tr>";                
                    str += "<th >" + tt2 + "</th>";
                    str += "<th >" + tt + "</th>";
                    str += "<th >" + tt3 + "</th>";
                    str += "<th >" + tt4+ "</th>";
                    str += "<th >" + tt5 + "</th>";
                    str += "<th>" + tt6 + "</th>";
                    str += "<th id='tt7'>" + tt7 + "</th>";
                    str += "<th >" + tt8 + "</th>";
                    str += "<th><a class='icon-edit' href='/Move/Product/Edit?orderNum=000001'  title='编辑'><span class='iconfont'>&#xe612;</span></a>&nbsp;&nbsp;&nbsp;&nbsp;";
                    str += "<a class='icon-remove' href='javascript:void(0)'onclick='$(this).parent().parent().remove();' title='删除'><span class='iconfont'>&#xe686;</span></a>&nbsp;&nbsp;&nbsp;</th> ";                            
                    str += "</tr>";
                   $("#tabInfo ").append(str);

               
       
       
        
        
    }//将文本框的值传入页面

    function check(checked){
	 var checks = document.getElementsByName("check");
		for (var i = 0; i < checks.length; i++) {
		checks[i].checked = checked;
			}
    }//类别的


      function check1(checked){
	 var checks = document.getElementsByName("check");
		for (var i = 0; i < checks.length; i++) {
		checks[i].checked = checked;
			}
    }//库位的


      function getCheckBoxValueThree1() {
           
             var data = $('input:checkbox[name="check2"]:checked').map(function () {
                 // console.log($(this).parents().find("th").eq(2).text());           
                 var ku=($(this).parent().next("th").next("th").text());//库存
                 $("#lzyqq").val(ku);               
                 return $(this).val();                
            }).get().join(",");
                              
    }//库位的

      function getCheckBoxValueThree() {
            //获取input类型是checkBox并且 name="box"选中的checkBox的元素
             var data = $('input:checkbox[name="check"]:checked').map(function () {
                 // console.log($(this).parents().find("th").eq(2).text());
                 var tt = ($(this).parent().next("th").next("th").text());//名称
                 var ss = ($(this).parent().next("th").next("th").next("th").next("th").text());//单价
                   var ss2 = ($(this).parent().next("th").next("th").next("th").next("th").next("th").text());//库存
                 $("#cpmc").val(tt);
                 $("#cpdj").val(ss);
                 $("#xykc").val("0");
                 return $(this).val();                
            }).get().join(",");
             //弹出结果cpgg
             $("#cpbm").val(data); //这个是id                 
    }//类别的

      function getCheckBoxValueThree2() {
         var data = $('input:checkbox[name="check1"]:checked').map(function () {
             // console.log($(this).parents().find("th").eq(2).text());           
             var t1 = ($(this).parent().next("th").text());//id
             var t2 = ($(this).parent().next("th").next("th").text());//供应商名称
             var t3 = ($(this).parent().next("th").next("th").next("th").text());//联系方式
             var t4=($(this).parent().next("th").next("th").next("th").next("th").text());//联系人

             $("#g1").val(t1);
             $("#g2").val(t2);
             $("#g3").val(t4);
             $("#g4").val(t3);

                 return $(this).val();                
            }).get().join(",");
    }//供应商


    function gyschaxun() {
        var names = $("#die").val();
        $.ajax({
            url: "@Url.Action("lzyrukugongyingshang")",
            data: { name: names },
            dataType: "json",
            type: "get",
            success: function (result) {

                $("#dh tr:gt(0)").remove();
                $("#dh").addClass("margin-top:-500px;")
                 $.each(result.re,  function (inde, value) {
                    var str = "<tr style='border: 1px #999999 solid;'>";
                    str += "<th><input type='checkbox' style='width: 30px;margin-left:0px; class='group-checkable' name='check1' value='"+value.supplierid+"'/></th>"
                    str += "<th style='width:225px;'>" + value.supplierid + "</th>";
                    str += "<th style='width:237px;margin-left:0px;'>" + value.supplierName + "</th>";
                    str += "<th style='width:160px;'>" + value.phone + "</th>";
                    str += "<th style='width:110px;'>" + value.contacts + "</th>";
                    str += "<th style='width:187px;'> " + value.Email + "</th>";
                    str += "<th style='width:127px;;'>" + value.address + "</th>";
                  
                    str += "</tr>";
                    $("#dh").append(str);

                });
            }
        });
    }//供应商

     
    function kuweichaxun() {
         var typeid = $("#leixing1").val();
        var names = $("#lb1").val();
         //库位查询
        $.ajax({
            url: "@Url.Action("lzyrukukuweiguanli")",
            data: { name: names, leixing: typeid },
            dataType: "json",
            type: "get",
            success: function (result) {

                $("#kuwei tr:gt(0)").remove();

                $.each(result.qq, function (inde, value) {

                    var str = "<tr class='widget-title'>";
                    str += "<th><input type='checkbox' style='width: 30px;margin-left:0px;' class='group-checkable' name='check2' value='"+value.kuweiid+"'/></th>"
                    str += "<th style='width:195px;margin-left:5px;'>" + value.kuweiid + "</th>";
                    str += "<th style='width:195px;'>" + value.kuweiname + "</th>";
                    str += "<th style='width:195px;'>" + value.kuWeiTypeid + "</th>";
                    str += "<th style='width:195px;'>" + value.forbidden + "</th>";
                    str += "<th style='width:195px;'>" + value.defaults + "</th>";
                    str += "</tr>";                  
                    $("#kuwei").append(str);

                });


            }
        });
    }//库位查询
    //新增供应商
    function addAction() {//新增供应商
        var Typeid = $("[name=danhao]").val();//入库类型
        var cpid = $("[name=d1]").val();//关联订单号
        var zdpeople = $("[name=d2]").val();//制单人
        var supplierid = $("[name=d3]").val();//供应商编号
        var supname = $("[name=d4]").val();//供应商名称
        var ContactName = $("[name=d5]").val();//供应商联系人
        var phone = $("[name=d6]").val();//供应商联系方式
        var beizhu = $("[name=d7]").val();//备注         
        var addtime = $("#sj").val();//制单时间

        var cpname = ($("[name=cpmc]").val());//产品名称
        var BarCode = ($("[name=mytd]").val());//产品条码
        var BatchNum = ($("[name=cpgg]").val());//规格
        var pici = ($("[name=cppc]").val());//批次
        var num = ($("[name=cpdj]").val());//单价
        var rkshuliang = ($("[name=rksl]").val());//入库数量就是货品总数
        var kuwei = ($("[name=rkkw]").val());//库位
        var money = $("#tt7").text();//总价
        $.ajax({//入库管理表
            url: "@Url.Action("rukuinserts")",
            data: {Typeid:Typeid,cpid:cpid,zdpeople:zdpeople,supplierid:supplierid,supname:supname,ContactName,ContactName,phone:phone,beizhu:beizhu,addtime:addtime,cpname:cpname,BarCode:BarCode,BatchNum:BatchNum,pici:pici,num:num,rkshuliang:rkshuliang,kuwei:kuwei,money:money  },
            dataType: "json",
            type: "get",
            success: function (result) {
                alert(result.Msg);
            }
        })
    }

    
   
   
   
    //类别查询
    function bindData() {
        var typeid = $("#leixing2").val();
         var names = $("#lb").val();
    //类别查询
        $.ajax({
            url: "@Url.Action("lzyruku")",
            data: { name: names, leixing: typeid },
            dataType: "json",
            type: "get",
            success: function (result) {

                $("#cctv tr:gt(0)").remove();

                $.each(result.ss,  function (inde, value) {

                    var str = "<tr  class='widget-title'>";
                    str += "<th><input type='checkbox' style='width: 30px;margin-left:0px;' class='group-checkable' name='check' value='"+value.Cpid+"'/></th>"
                    str += "<th style='width:225px;'>" + value.Cpid + "</th>";
                    str += "<th style='width:300px;'>" + value.commodityname + "</th>";
                    str += "<th style='width:145px;'>" + value.productid + "</th>";
                    str += "<th style='width:155px;'>" + value.price + "</th>";
                    str += "<th style='width:130px;'>" + value.metering + "</th>";

                    str += "</tr>";
                    $("#cctv").append(str);

                });


            }
        });
    }

</script>

@using com.tdxm.model;
@using xiangmu.FuZhu;
@{
    ViewBag.Title = "RuKu";
    Layout = "~/Views/mubanye/ym.cshtml";
}
    <style>
        .black_overlay {
            display: none;
            position: absolute;
            top: 0%;
            left: 0%;
            width: 100%;
            height: 150%;
            background-color: black;
            z-index: 1001;
            opacity: .80;
            filter: alpha(opacity=88);
        }

        .white_content {
            display: none;
            position: absolute;
            top: 25%;
            left: 15%;
            width: 60%;
            height: 75%;
            padding: 20px;
            background-color: white;
            z-index: 1002;
            overflow: auto;
        }
    </style>


<head>
    <link href="~/images/iconfont/iconfont.css" rel="stylesheet" />
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>仓储管理系统</title>
    <meta name="keywords" content="仓储管理系统" />
    <meta name="description" content="仓储管理系统" />

    <link href="/Theme/plugins/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="/Theme/plugins/font-awesome/css/font-awesome.css" rel="stylesheet" type="text/css" />
    <link href="/Theme/css/style.css" rel="stylesheet" type="text/css" />
    <link href="/Theme/css/style-responsive.css" rel="stylesheet" type="text/css" />
    <link href="/Theme/css/themes/default.css" rel="stylesheet" type="text/css" />
    <link href="/Theme/plugins/jbox-v2.3/jBox/Skins/Gray/jbox.css" rel="stylesheet" type="text/css" />
    <link href="/Theme/plugins/jquery-autocomplete3.2.2/jquery.autocomplete.css" rel="stylesheet" type="text/css" />
</head>
<body class="fixed-top" style=" width:1600px; margin-left:290px">

    <div id="container" class="row-fluid "></div>

        <div id="header" class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="brand" href="javascript:void(0)" style="width: 180px; color: white;">仓储管理系统</a>
                    <a class="btn btn-navbar collapsed" id="main_menu_trigger" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="arrow"></span>
                    </a>
                    @*<div class="top-nav">
                            <ul class="nav pull-right" id="top_menu">
                                <li class="divider-vertical hidden-phone hidden-tablet"></li>

                                <li class="divider-vertical hidden-phone hidden-tablet"></li>
                                <li class="dropdown">
                                    <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown">
                                        <i class="icon-user"></i>&nbsp;当前登录
                                        <b class="caret"></b>
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li><a href="javascript:void(0)" onclick="AccountSetting.Add();"><i class="icon-user"></i>&nbsp;&nbsp;administrator</a></li>
                                        <li><a href="javascript:void(0)" onclick="AccountSetting.Edit();"><i class="icon-wrench"></i>&nbsp;&nbsp;修改密码</a></li>
                                        <li><a href="/Home/LoginOut"><i class="icon-key"></i>退出系统</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>*@
                </div>
            </div>
        </div>

        <div id="container" class="row-fluid ">

            <div id="sidebar" class="nav-collapse collapse">
                <div class="sidebar-toggler hidden-phone"></div>
                <ul>

                    <li class="has-sub "><a href="javascript:void(0);"><i class="icon-bookmark-empty"></i><span class="title">系统设置</span><span class="arrow "></span></a><ul class="sub"><li><a href="/Home/UserList">员工管理</a></li><li><a href="/Home/RoleList">角色管理</a></li><li><a href="/Home/DepartList">部门管理</a></li><li><a href="/Res/Index">菜单管理</a></li><li><a href="/Res/Power">权限分配</a></li><li><a href="/Home/SN">标识符管理</a></li></ul></li>
                    <li class="has-sub "><a href="javascript:void(0);"><i class="icon-bookmark-empty"></i><span class="title">基本资料</span><span class="arrow "></span></a><ul class="sub"><li><a href="/Storage/Location/List">库位管理</a></li><li><a href="/Client/Supplier/Index">供应商管理</a></li><li><a href="/Client/Customer/Index">客户管理</a></li><li><a href="/Storage/Measure/Index">计量单位</a></li><li><a href="/Product/Goods/List">产品类别</a></li><li><a href="/Product/Goods/Index">产品管理</a></li></ul></li>
                    <li class="has-sub active"><a href="javascript:void(0);"><i class="icon-bookmark-empty"></i><span class="title">仓库作业</span><span class="arrow open"></span></a><ul class="sub"><li class="active"><a href="/InStorage/Product/List">入库管理</a></li><li><a href="/OutStorage/Product/List">出库管理</a></li><li><a href="/Bad/Product/List">报损管理</a></li><li><a href="/Move/Product/List">移库管理</a></li><li><a href="/Check/Product/List">盘点管理</a></li><li><a href="/Returns/Product/List">退货管理</a></li></ul></li>
                    <li class="has-sub "><a href="javascript:void(0);"><i class="icon-bookmark-empty"></i><span class="title">报表管理</span><span class="arrow "></span></a><ul class="sub"><li><a href="/Report/Report/StockBillReport">库存清单</a></li><li><a href="/Report/Report/ProductReport">货品统计</a></li><li><a href="/Report/Report/ProductInOutReport">出入库报表</a></li><li><a href="/Report/Report/InStorageReport">入库报表</a></li><li><a href="/Report/Report/OutStorageReport">出库报表</a></li><li><a href="/Report/Report/BadReport">报损报表</a></li><li><a href="/Report/Report/ReturnReport">退货报表</a></li><li><a href="/Report/Report/CustomerReport">客户报表</a></li><li><a href="/Report/Report/SupplierReport">供应商报表</a></li><li><a href="/Report/Report/InventoryReport">台账记录</a></li><li><a href="/Report/Manager/List">自定义报表</a></li></ul></li>
                    <li class="">
                        <a href="/Home/LoginOut">
                            <i class="icon-user"></i>
                            <span class="title">退出系统</span>
                        </a>
                    </li>

                </ul>
            </div>

            <div id="body">
                <div id="widget-config" class="modal hide">
                    <div class="modal-header">
                        <button data-dismiss="modal" class="close" type="button"></button>
                        <h3>widget Settings</h3>
                    </div>
                    <div class="modal-body">
                        <p>Here will be a configuration form</p>
                    </div>
                </div>
                <div class="container-fluid">
                    <div class="row-fluid">
                        <div class="span12">
                            <ul class="breadcrumb"><li><i class="icon-home"></i><a href="#">首页</a><i class="icon-angle-right"></i></li><li><a href="#">仓库作业</a><i class="icon-angle-right"></i></li><li><a href="#">入库管理</a></li></ul>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span12">
                            <div class="widget box light-grey">
                                <div class="widget-title">
                                    <h4><i class="icon-globe"></i>入库单管理</h4>
                                    <div class="tools">
                                        <a href="javascript:;" class="collapse"></a>
                                        <a href="#widget-config" data-toggle="modal" class="config"></a>
                                        <a href="javascript:;" class="reload"></a>
                                        <a href="javascript:;" class="remove"></a>
                                    </div>
                                </div>
                                <div class="widget-body">
                                    <div class="clearfix margin-bottom-10">
                                        <div class="btn-group" id="btnStatusGroup">
                                            <button class="btn" value="0" id="auditname" name="auditname">所有</button>
                                            <button class="btn" value="1" id="btna" type="submit" name="auditname">待审核</button>
                                            <button class="btn" value="2" id="btnb" type="submit" name="auditname">审核通过</button>
                                            <button class="btn" value="3" id="btnc" type="submit" name="auditname">审核失败</button>

                                        </div>

                                        <div class="actions  pull-right">
                                            <a class="btn btn-primary" href="@Url.Action("RuKuinsert")"><i class="icon-pencil"></i>&nbsp;新增</a>

                                            <button type="button" class="btn btn-danger" id="scan">删除</button>
                                            <a class="btn btn-info" href="#" onclick="InStorageManager.ToExcel()"><i class="icon-download"></i>&nbsp;导出</a>
                                        </div>
                                    </div>

                                    <div class="row-fluid">
                                        <form class="form-horizontal" action="javascript:void(0)">
                                            <div class="control-group">
                                                <div class="controls controls-cus " style="margin-top:20px;">
                                                    <div class="row">
                                                        <input type="hidden" id="txtReprtNum" name="txtReportNum" value="InOrderPrint" />

                                                        <input id="RKDanHao" type="text" name="RKDanHao" placeholder="请输入库单编号号" class="form-control" style="width:300px;margin-left:15px;" />

                                                        时间
                                                        <input id="Stratdate" value="@DateTime.Now.AddDays(-7).ToString("yyyy-MM-dd")" style="width:300px" type="date" name="Stratdate" class="form-control" />
                                                        到<input id="Enddate" value="@DateTime.Now.AddDays(1).ToString("yyyy-MM-dd")" type="date" style="width:300px" name="Enddate" class="form-control" />
                                                        <button id="btncx" class="col-md-1 btn btn-primary " style="margin-left:50px;margin-top:0px;" type="submit">查询</button>



                                                        <button id="btn" value="显示" class="col-md-1 btn btn-primary " style="margin-left:20px;margin-top:0px; width:50px;" type="submit">高级搜索</button>

                                                        @*<button id="btnHSearch" data-toggle="dropdown" class="btn btn-primary dropdown-toggle">高级搜索 <span class="caret"></span></button>*@

                                                    </div>


                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div id="divHSearch" class="row-fluid hide">
                                        <div class="widget">
                                            @*<div class="widget-body form">
                                                    <form class="horizontal-form" action="javascript:void(0)">

                                                        <div class="row">
                                                            <div class="col-md-3">
                                                                <label>报损单编号</label>
                                                                <input name="Name" type="text" class="form-control" style="width:200px" />
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label>报损类型</label>
                                                                <input name="Brand" type="text" class="form-control " style="width:200px" />
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label>关联订单号</label>
                                                                <input name="Money" type="text" class="form-control" style="width:200px" />
                                                            </div>

                                                            <div class="col-md-3">

                                                                <label for="firstName" class="control-label">&nbsp;&nbsp;</label>
                                                                <a class="btn btn-info" href="javascript:void(0)" onclick="InStorageManager.PageClick(1,10)"><i class="icon-search"></i>&nbsp;搜索</a>

                                                            </div>



                                                        </div>
                                                    </form>
                                                </div>*@
                                            <div class="widget-body form" style="margin-top:20px;display:none;" id="dv">
                                                @*<form class="horizontal-form" action="javascript:void(0)">*@
                                                <div class="row-fluid">
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <label>客户</label>
                                                        <input id="supplierName" name="supplierName" type="text" class="form-control" style="width:200px" />
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>单据类型</label>
                                                        <div class="controls">
                                                            @Html.DropDownList("Type", null, htmlAttributes: new { @class = "form-control", @style = "width:150px;" })
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>关联单号</label>
                                                        <input name="Money" type="text" class="form-control" style="width:200px" />
                                                    </div>

                                                    <div class="col-md-3">

                                                        <label for="firstName" class="control-label">&nbsp;&nbsp;</label>

                                                        <button id="btngjcx" class="col-md-4 btn btn-primary" style="margin-left:-55px; margin-top:20px" type="submit">查询</button>
                                                    </div>



                                                </div>
                                                @*</form>*@
                                            </div>
                                        </div>
                                    </div>

                                    <table class="table table-striped table-bordered table-hover" id="tabInfo" style="margin-top:20px;">
                                        <thead>
                                            <tr class="widget-title">
                                                <th><input id="qxname" name="qxname" type="checkbox" class="group-checkable" /></th>
                                                @*<th style="width: 8px;"><input type="checkbox" class="group-checkable" onclick="InStorageManager.SelectAll(this)" /></th>*@
                                                <th class="hidden-480">入库单号</th>
                                                <th class="hidden-480">入库类型</th>
                                                <th class="hidden-480">供应商</th>
                                                <th class="hidden-480">关联单号</th>
                                                <th class="hidden-480">货品总数</th>
                                                <th class="hidden-480">总金额</th>
                                                <th class="hidden-480">状态</th>
                                                <th class="hidden-480">制单人</th>
                                                <th class="hidden-480">操作方式</th>
                                                <th class="hidden-480">创建时间</th>
                                                <th class="hidden-480">供应商名称</th>
                                                
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                    <div class="form-inline form-group">
                                        <button id="btnsy" class="btn btn-info form-group">首页</button>
                                        <button id="btsyy" class="btn btn-info form-group">上一页</button>
                                        <input type="text" id="txtpageIndex" class="form-control" style="width:110px;" />
                                        <button id="btGo" class="btn btn-info form-group">Go</button>
                                        <button id="btnxyy" class="btn btn-info form-group">下一页</button>
                                        <button id="btnwy" class="btn btn-info form-group">尾页</button>
                                        <label id="txtLabel" style="font-size:16px;margin:0px auto;"></label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="footer">
        </div>

        <script type="text/javascript" src="/Theme/plugins/jquery-1.8.3.min.js?t=d3f1534d-8412-4031-999a-5a505055f34b"></script>
        <script type="text/javascript" src="/Theme/plugins/bootstrap/js/bootstrap.min.js?t=25773eda-9a3a-4b6a-acb1-77d160dc3af4"></script>
        <script type="text/javascript" src="/Theme/plugins/jbox-v2.3/jBox/jquery.jBox-2.3.min.js?t=de8ce5d1-351c-4550-b889-c775c813aa17"></script>
        <script type="text/javascript" src="/Common/Js?t=3192e1b1-e2f6-446d-984e-8644409a12cf"></script>
        <script type="text/javascript" src="/Theme/plugins/My97DatePicker/WdatePicker.js?t=2cff84d0-a1cd-46bf-b950-c6afc5b54439"></script>
        <script type="text/javascript" src="/Theme/plugins/jquery-autocomplete3.2.2/jquery.autocomplete.js?t=4359fb65-9dca-4048-9791-d35040a47ac1"></script>
        <script type="text/javascript" src="/Theme/customer/Git.Framework.Common.js?t=8cf63086-2e57-4cea-bf51-6a42d430d45b"></script>
        <script type="text/javascript" src="/Theme/customer/Git.Framework.UICommon.js?t=48829e00-fd5f-4d6b-8a04-5dcfe16cef8b"></script>
        <script type="text/javascript" src="/Theme/customer/InStorage/Git.Storage.ProductInOrder.js?t=dcdc1c5d-3324-4356-a015-1a08682d51cb"></script>

        <script type="text/javascript">
        var aner = 0;
        var pageIndexvalue = 1;
        document.getElementById("btn").onclick = function () {
            //使用if判断，判断button按钮的value属性
            if (this.value === "隐藏") {
                // 如果是隐藏，那么点击后通过div盒子的id修改css样式，将display属性值改为none
                document.getElementById("dv").style.display = "none";
                //this关键字获取的是当前对象  通过this关键字来修改button的value值
                this.value = "显示";
            } else if (this.value === "显示") {
                // 如果是显示，那么点击后通过div盒子的id修改css样式，将display属性值改为block
                document.getElementById("dv").style.display = "block";
                //this关键字获取的是当前对象  通过this关键字来修改button的value值
                this.value = "隐藏";
            }
        };
    $(function () {


            //审核
            $("#btnStatusGroup .btn").click(function () {
                var sh = $(this).val();
                aner = sh
                bingdate(sh);
            });

        $("#btnsy").click(function () {
            pageIndexvalue = 1;
            bingdate(aner);
        })
        $("#btsyy").click(function () {
            pageIndexvalue = pageIndexvalue - 1;
            bingdate(aner);
        })
        $("#btGo").click(function () {
            pageIndexvalue = parseInt($("#txtpageIndex").val());
            bingdate(aner);
        })
        $("#btnxyy").click(function () {
            pageIndexvalue = pageIndexvalue + 1;
            bingdate(aner);
        })
        $("#btnwy").click(function () {
            pageIndexvalue = 999999;
            bingdate(aner);
        })
        //删除按钮
        $("#scan").click(function () {
            BindDelete();
        });  //删除
        function BindDelete() {

            var CLength = $("[name=fxkname]:checked").length;
            if (CLength == 1) {
                var CIdValueDelete = $("[name=fxkname]:checked").parent().next().text();
                if (confirm("确定删除出库单号为【" + CIdValueDelete + "】的数据吗？")) {
                    $("[name=fxkname]:checked").parent().parent().find("td").remove();
                }
            } else if (CLength > 1) {
                var CheckedLength = $("[name=fxkname]:checked").length;
                if (confirm("确定删除这【" + CheckedLength + "】项？")) {
                    $("[name=fxkname]:checked").parent().parent().find("td").remove();
                }
            } else if (CLength < 1) {
                alert("请选择要删除项！");
            }

        }



            $("#btncx").click(function () {
                bingdate(aner);
            });
            $("#btngjcx").click(function () {
                bingdate(aner);
            });

            bingdate(aner);

    })

        function bingdate(aand) {
        var namevalue = $("[name=RKDanHao ]").val();
        var Stratdatevalue = $("[name=Stratdate]").val();
        var Enddatevalue = $("[name=Enddate]").val();
        var CNames = $("[name=supplierName ]").val();
        var Typevalue = $("#Type").val();
        var audit = $("[name=auditname ]").val();

        $.ajax({
              url:"@Url.Action("RuKuCha")",
            data: { RKDanHao: namevalue, Stratdate: Stratdatevalue, Enddate: Enddatevalue, supplierName: CNames, typeid: Typevalue, auditname: audit, pageIndex: pageIndexvalue, aid: aand},
            dataType: "json",
            type: "get",
            success: function (fwResult) {
                $("#txtLabel").html("当前第" + fwResult.PageIndex + " 页 / 共计" + fwResult.Count + " 页 共计" + fwResult.PageCount+ " 条");

                $("#txtpageIndex").val(fwResult.PageIndex);

                pageIndexvalue = fwResult.PageIndex;

                $("table tr:gt(0)").remove();
                $.each(fwResult.fwaction, function (index, value) {
                    var str = "<tr>";
                    str += "<td><input name=\"fxkname\" type=\"checkbox\" class=\"group-checkable\" /></td>";
                    str += "<td>" + value.Inid + "</td>";
                    str += "<td>" + value.typename + "</td>";
                    str += "<td>" + value.Cpid + "</td>";
                    str += "<td>" + value.Cpid + "</td>";
                    str += "<td>" + value.Count + "</td>";
                    str += "<td>" + value.money + "</td>";
                    str += "<td>" + value.auditname + "</td>";
                    str += "<td>" + value.czfs + "</td>";
                    str += "<td>" + value.zdpeople + "</td>";
                    str += "<td>" + value.AddTime + "</td>";
                    str += "<td>" + value.ProductNames + "</td>";
                    //  <a href='/CanGuan/RuKuDelete/" + value.Inid + "'>删除</a>
                    str += "<td><button type='button' onclick='Del(" + value.Inid + ")'>删除</button><a href='/CanGuan/Update/" + value.Inid + "'>修改</a></td>";
                    str += "</tr>";
                    $("table tbody").append(str);
                })
            }

        })
    }


            function Del(id) {
                if (confirm('是否删除?')) {
                    $.ajax({
                        type: "POST",
                        url: "/CanGuan/DelInStorageRK",
                        data: "{Id:'" + id + "'}",
                        dataType: "json",
                        contentType: "application/json",
                        success: function (result) {
                            if (result > 0) {
                                alert("删除成功");
                                bingdate(aner);
                            }
                            else {
                                alert("删除失败");
                            }
                        },
                        error: function (ex) {
                            alert(ex.responseText);
                        }
                        ,
                    });
                }
            }      
        </script>

</body>
